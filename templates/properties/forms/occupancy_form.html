{% extends 'base.html' %}

{% block title %}Assign Resident - PropertyNest{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">
            <i class="bi bi-person-check text-primary"></i>
            Assign Resident
        </h1>
        <p class="page-subtitle">Assign a resident to a flat or PG bed</p>
    </div>
    <a href="{% url 'properties:tenant_list' %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back
    </a>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-circle me-2"></i>
                        {{ form.non_field_errors }}
                    </div>
                    {% endif %}
                    
                    <!-- Resident Selection -->
                    <div class="mb-4">
                        <h6 class="fw-600 text-primary mb-3">
                            <i class="bi bi-person me-2"></i>Select Resident
                        </h6>
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label fw-500">Resident <span class="text-danger">*</span></label>
                                {{ form.tenant }}
                                {% if form.tenant.errors %}<div class="text-danger small mt-1">{{ form.tenant.errors }}</div>{% endif %}
                                {% if not tenant_id %}
                                <div class="mt-2">
                                    <a href="{% url 'properties:add_tenant' %}" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-plus-lg me-1"></i> Add New Resident
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Unit/Bed Selection -->
                    <div class="mb-4">
                        <h6 class="fw-600 text-primary mb-3">
                            <i class="bi bi-house-door me-2"></i>Select Location
                        </h6>
                        
                        {% if not unit_id and not bed_id %}
                        <div class="alert alert-info py-2 small">
                            <i class="bi bi-info-circle me-1"></i> 
                            Select a Unit (for Flat) <strong>OR</strong> Bed (for PG)
                        </div>
                        {% endif %}
                        
                        <div class="row g-3">
                            {% if not bed_id %}
                            <div class="col-md-6" id="unit-field">
                                <label class="form-label fw-500">Flat Unit</label>
                                {{ form.unit }}
                                {% if form.unit.errors %}<div class="text-danger small mt-1">{{ form.unit.errors }}</div>{% endif %}
                            </div>
                            {% else %}
                            {{ form.unit }}
                            {% endif %}
                            
                            {% if not unit_id %}
                            <div class="col-md-6" id="bed-field">
                                <label class="form-label fw-500">PG Bed</label>
                                {{ form.bed }}
                                {% if form.bed.errors %}<div class="text-danger small mt-1">{{ form.bed.errors }}</div>{% endif %}
                            </div>
                            {% else %}
                            {{ form.bed }}
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Rent Details -->
                    <div class="mb-4">
                        <h6 class="fw-600 text-primary mb-3">
                            <i class="bi bi-cash me-2"></i>Rent Details
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-500">Monthly Rent <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text bg-primary text-white">₹</span>
                                    {{ form.rent }}
                                </div>
                                {% if form.rent.errors %}<div class="text-danger small mt-1">{{ form.rent.errors }}</div>{% endif %}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-500">Security Deposit</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-success text-white">₹</span>
                                    {{ form.deposit }}
                                </div>
                                {% if form.deposit.errors %}<div class="text-danger small mt-1">{{ form.deposit.errors }}</div>{% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Move-in Date -->
                    <div class="mb-4">
                        <h6 class="fw-600 text-primary mb-3">
                            <i class="bi bi-calendar me-2"></i>Move-in Details
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-500">Move-in Date <span class="text-danger">*</span></label>
                                {{ form.start_date }}
                                {% if form.start_date.errors %}<div class="text-danger small mt-1">{{ form.start_date.errors }}</div>{% endif %}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-500">Notes</label>
                                {{ form.notes }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2 pt-3 border-top">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-lg me-1"></i> Assign Resident
                        </button>
                        <a href="{% url 'properties:tenant_list' %}" class="btn btn-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card bg-primary-light">
            <div class="card-body">
                <h6 class="fw-600 mb-3"><i class="bi bi-lightbulb me-2"></i>Quick Tips</h6>
                <ul class="small mb-0" style="padding-left: 1.25rem;">
                    <li class="mb-2">For flats: Select a unit from the dropdown</li>
                    <li class="mb-2">For PG: Select a specific bed</li>
                    <li class="mb-2">Set the correct rent amount</li>
                    <li>Move-in date starts the billing cycle</li>
                </ul>
            </div>
        </div>
        
        <div class="card mt-3 bg-warning-light">
            <div class="card-body">
                <h6 class="fw-600 mb-2"><i class="bi bi-exclamation-triangle me-2"></i>Note</h6>
                <p class="small mb-0">Once assigned, the unit/bed will be marked as occupied automatically.</p>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const unitSelect = document.getElementById('id_unit');
    const bedSelect = document.getElementById('id_bed');
    const unitDiv = document.getElementById('unit-field');
    const bedDiv = document.getElementById('bed-field');
    
    function toggleFields() {
        if (unitSelect && unitSelect.value) {
            if (bedDiv) bedDiv.style.opacity = '0.5';
        } else {
            if (bedDiv) bedDiv.style.opacity = '1';
        }
        
        if (bedSelect && bedSelect.value) {
            if (unitDiv) unitDiv.style.opacity = '0.5';
        } else {
            if (unitDiv) unitDiv.style.opacity = '1';
        }
    }
    
    if (unitSelect) unitSelect.addEventListener('change', toggleFields);
    if (bedSelect) bedSelect.addEventListener('change', toggleFields);
    toggleFields();
});
</script>
{% endblock %}
